<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <!-- https://electronjs.org/docs/tutorial/security#csp-meta-tag -->

    <script type="text/javascript" src="domain.js"></script>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="node_modules/materialize-css/dist/css/materialize.min.css"  media="screen,projection"/>
    <link type="text/css" rel="stylesheet" href="custom.css"  media="screen,projection"/>

    <script type="text/javascript" src="node_modules/materialize-css/dist/js/materialize.min.js"></script>
    <script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script>
    <script charset="UTF-8" src="dist/fuzzball.umd.min.js"></script>
    <script>window.$ = window.jQuery = require('jquery');</script>

    <script>
        $(document).ready(function(){
        
            var $loading = $('#loadingDiv').hide();
            $(document)
            .ajaxStart(function () {
                $loading.show();
            })
            .ajaxStop(function () {
                $loading.hide();
            });
        });
    </script>
    <!-- <script>
        $(document).ready(function(){

        });
    </script> -->


  </head>
  <body>
    <div class="container">
        <div class="row">
            <div class="col s12" id="asd">
                <div class="card blue-grey darken-1">
                    <div class="card-content white-text">
                      <span class="card-title">Card Title</span>
                      <p>I am a very simple card. I am good at containing small bits of information.
                      I am convenient because I require little markup to use asdasf.</p>
                      <a class="btn-floating halfway-fab waves-effect waves-light red" onclick="sajt()"><i class="material-icons">add</i></a>
                      <script>
                          function sajt(){
                            var request = new XMLHttpRequest();
                            request.open('GET', 'http://www.domain.hu/domain/varolista/ido.html', true);
                            request.overrideMimeType('text/html; charset=iso-8859-2');
                            request.onload = function() {
                                if (this.status >= 200 && this.status < 400) {
                                    // console.log(this.response);
                                    var element = document.createElement('html');
                                    element.innerHTML=this.response;
                                    var elements = element.getElementsByTagName('table')[0].getElementsByTagName('tr');
                                    var domains = [];
                                    for (let i = 1; i < 10; i++) {
                                        const element = elements[i];
                                        const tds = element.getElementsByTagName('td');
                                        var first = tds[4].innerHTML.indexOf('"');
                                        var last = tds[4].innerHTML.lastIndexOf('"');
                                        domain = new Domain(tds[1].innerText, tds[2].innerText, tds[3].innerText, tds[4].innerHTML.substring(first+1, last));
                                        domains.push(domain);
                                    }
                                    console.log(domains.join('\n'));
                                    
                                    domains.forEach(domain => {
                                        inner = `
                                            <div class="card-content black-text">
                                                <span class="card-title">${domain.name}</span>
                                                <blockquote>
                                                    <p>Beküldő: ${domain.sender}</p>
                                                    <p>Regisztráció időpontja: ${domain.date}</p>
                                                </blockquote>
                                                <a class="waves-effect waves-light btn-flat" href="http://www.domain.hu/domain/varolista/${domain.url}" target="_blank">Részletek</a>
                                            </div>
                                        `;
                                        var element = document.createElement('div');
                                        element.classList.add('card');
                                        element.innerHTML=inner;
                                        document.getElementById('asd').appendChild(element);
                                    });
                                } else {
                                }
                            };
                            request.send();
                          }
                      </script>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    
    
    <div id="loadingDiv">
        <div class='right preloader-wrapper active'>
            <div class='spinner-layer spinner'>
            <div class='circle-clipper left'>
                <div class='circle'></div>
            </div><div class='gap-patch'>
                <div class='circle'></div>
            </div><div class='circle-clipper right'>
                <div class='circle'></div>
            </div>
            </div>
        </div>
    </div>
    <div id="content">

    </div>
  </body>
</html>